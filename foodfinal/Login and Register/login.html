<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FOODHUB</title>
    <link rel="stylesheet" href="index.css" />
</head>

<body>
    <div class="form-container" id="loginFormContainer">
        <form id="loginForm">
            <h2>Login</h2>
            <label for="role">Role:</label>
            <select id="role" name="role" required>
          <option value="users">User</option>
          <option value="admin">Admin</option>
        </select>
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" placeholder="Enter your username" required />

            <label for="password">Password:</label>
            <input type="password" id="password" name="password" placeholder="Enter your password" required />
            <button type="submit">Login</button>
            <p>
                Forgot your password?
                <a href="forgot_password.html">Reset here</a>
            </p>
            <p>
                Don't have an account?
                <a href="register.html">Register now</a>
            </p>
        </form>
    </div>
    <script>
        document
            .getElementById("loginForm")
            .addEventListener("submit", function(e) {
                e.preventDefault();
                // Pre-populate the username and password fields
                const username = document.getElementById("username").value;
                const password = document.getElementById("password").value;
                const role = document.getElementById("role").value;
                const loginData = {
                    username: document.getElementById("username").value,
                    password: document.getElementById("password").value,
                    role: document.getElementById("role").value,
                };
                console.log("Login Data:", loginData);
                if (!loginData.username || !loginData.password) {
                    alert("All fields are required");
                    return;
                }
                fetch("http://localhost:3000/login", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify(loginData),
                    })
                    .then((response) => response.json())
                    .then((data) => {
                        if (data.success) {
                            alert(data.message);
                            if (role === "admin") {
                                // Redirect to the admin dashboard page
                                window.location.href = "../Admin/admin_dashboard.html"; // Adjust the path as needed
                            } else if (role === "users") {
                                localStorage.setItem("userId", data.testerId);
                                // Redirect to the tester page (or the main page for testers)
                                window.location.href = "../Main-web/index.html"; // Adjust the path as needed
                            }
                        } else {
                            alert(data.message);
                        }
                    })
                    .catch((error) => console.error("Error:", error));
            });
    </script>
</body>

</html>